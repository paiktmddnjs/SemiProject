<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kh.spring.mapper.MemberMapper">

    <insert id="insertMember" parameterType="com.kh.spring.dto.MemberDto" keyProperty="memberId">
        INSERT INTO MEMBER (
        MEMBER_ID, EMAIL, MEMBER_PWD, MEMBER_NAME, PHONE, ENROLL_DATE, MODIFY_DATE, STATUS, ROLE
        ) VALUES (
        SEQ_MEMBER_ID.NEXTVAL,  <!-- 시퀀스 사용 -->
        #{email},
        #{memberPwd},
        #{memberName},
        #{phone, jdbcType=VARCHAR},
        SYSTIMESTAMP,
        SYSTIMESTAMP,
        #{status, jdbcType=VARCHAR},
        #{role, jdbcType=VARCHAR}
        )
    </insert>

    <!-- 로그인: 이메일과 비밀번호로 회원 조회 -->
    <select id="selectMemberByEmailAndPassword" resultType="com.kh.spring.dto.MemberDto">
        SELECT 
            MEMBER_ID as memberId,
            EMAIL as email,
            MEMBER_PWD as memberPwd,
            MEMBER_NAME as memberName,
            PHONE as phone,
            ENROLL_DATE as enrollDate,
            MODIFY_DATE as modifyDate,
            STATUS as status,
            ROLE as role
        FROM MEMBER
        WHERE EMAIL = #{email}
          AND MEMBER_PWD = #{memberPwd}
          AND STATUS = 'Y'
    </select>

    <!-- 이메일 중복 체크 -->
    <select id="selectMemberByEmail" resultType="com.kh.spring.dto.MemberDto">
        SELECT 
            MEMBER_ID as memberId,
            EMAIL as email,
            MEMBER_PWD as memberPwd,
            MEMBER_NAME as memberName,
            PHONE as phone,
            ENROLL_DATE as enrollDate,
            MODIFY_DATE as modifyDate,
            STATUS as status,
            ROLE as role
        FROM MEMBER
        WHERE EMAIL = #{email}
    </select>

</mapper>
